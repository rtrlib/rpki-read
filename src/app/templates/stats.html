{% extends "base.html" %}
{% block script %}
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
        google.load("visualization", "1", {packages:["corechart"], 'language': 'en'});
        google.setOnLoadCallback(drawLineCharts);

        function drawLineCharts() {
            var ldata_all = new google.visualization.DataTable();
            ldata_all.addColumn('datetime', 'Timestamp');
            ldata_all.addColumn('number', 'Valid');
            ldata_all.addColumn('number', 'Invalid Length');
            ldata_all.addColumn('number', 'Invalid AS');
            ldata_all.addColumn('number', 'Not Found');
            ldata_all_json = {{ stats.last24h|tojson }}
            $.each(ldata_all_json, function(i,row) {
                ldata_all.addRow([
                    (new Date(row.ts*1000)),
                    parseInt(row.num_Valid),
                    parseInt(row.num_InvalidLength),
                    parseInt(row.num_InvalidAS),
                    parseInt(row.num_NotFound)
            });

            var ldata_roa = new google.visualization.DataView(ldata_all);
            ldata_roa.setColumns([0,1,2,3]); // skip column with NotFound

            var lopts_all = {
                hAxis:{format: 'yy/MM/dd\nHH:mm'},
                series: {
                    0: { color: '#33a02c' },
                    1: { color: '#ff7f00' },
                    2: { color: '#e31a1c' },
                    3: { color: '#888888' }
                },
                legend:{position: 'top'},
                chartArea:{left:'5%',top:'10%',width:'90%',height:'90%'}
            };
            var lopts_roa = {
                hAxis:{format: 'yy/MM/dd\nHH:mm'},
                series: {
                    0: { color: '#33a02c' },
                    1: { color: '#ff7f00' },
                    2: { color: '#e31a1c' }
                },
                legend:{position: 'top'},
                chartArea:{left:'5%',top:'10%',width:'90%',height:'90%'}
            };

            var lchart_all = new google.visualization.LineChart(document.getElementById('lChartAll24h'));
            var lchart_roa = new google.visualization.LineChart(document.getElementById('lChartROA24h'));
            lchart_all.draw(ldata_all, lopts_all);
            lchart_roa.draw(ldata_roa, lopts_roa);
        }
    </script>
{% endblock %}
{% block content %}
        <div class="row">
            <div class="col-xs-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h1>RPKI READ - Statistics</h1>
                        <h4>
                            <span class="pull-left">Timestamp: <span class="label label-primary">{{ stats.latest_ts }}</span></span>
                            <span class="pull-right">BGP Source: <span class="label label-primary">{{ stats.source }}</span></span>
                        </h4>
                        </br>
                    </div>
                    <div class="panel-body">
                        <p class="text-primary lead">
                            This page provides a variety of statistics on the latest RPKI origin
                            AS validation results. Some of the graphs shown below may include
                            historical (e.g. last 24h) or data from third parties such as the RIRs.
                            The statistics cover all IP prefix advertised by the given BGP source
                            and up to a certain timestamp, as shown above.
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h2>RPKI Validition Results over last 24h</h2>
                    </div>
                    <div class="panel-body">
                        <p class="text-info">
                        </p>
                        <div class="row row-eq-height">
                            <div class="col-md-6 col-xs-12">
                                <h4>Advertised Prefix Origins</h4>
                                <div id="lChartAll24h" style="height: 100%"></div>
                            </div> <!-- div panel body col right -->
                            <div class="col-md-6 col-xs-12">
                                <h4>RPKI verifiable Origins</h4>
                                <div id="lChartROA24h" style="height: 100%"></div>
                            </div> <!-- div panel body col right -->
                        </div> <!-- div row-eq-height -->
                    </div> <!-- div panel body -->
                </div> <!-- div panel -->
            </div> <!-- div col stats -->
        </div><!-- div row  -->
{% endblock %}
